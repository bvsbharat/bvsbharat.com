---
import Layout from "./Layout.astro";
import Header from "@/components/Header.astro";
import Footer from "@/components/Footer.astro";
import Hr from "@/components/Hr.astro";
import FormattedDate from "@/components/FormattedDate.astro";
import Tag from "@/components/Tag.astro";
import ShareLinks from "@/components/ShareLinks.astro";
import EditPost from "@/components/EditPost.astro";
import { getReadingTime } from "@/utils/readingTime";
import { render, type CollectionEntry } from "astro:content";

interface Props {
  post: CollectionEntry<"blog">;
}

const { post } = Astro.props;
const { title, description, pubDatetime, modDatetime, tags, heroImage } = post.data;
const { Content } = await render(post);
const readingTime = getReadingTime(post.body ?? "");
---

<Layout
  title={title}
  description={description}
  pubDatetime={pubDatetime}
  modDatetime={modDatetime}
  scrollSmooth
>
  <Header />
  <main id="main-content" class="mx-auto w-full flex-1 px-4 pb-12" style="max-width:1020px">
    <article data-pagefind-body>
      <header class="mb-8 mt-8">
        <h1
          class="text-2xl font-bold leading-tight tracking-wide text-accent sm:text-3xl"
          style={`view-transition-name: post-${post.id.replace(/\.(md|mdx)$/, "").replace(/\//g, "-")}`}
        >{title}</h1>
        <div class="mt-3 flex flex-wrap items-center gap-3 text-sm opacity-70">
          <FormattedDate date={pubDatetime} />
          {modDatetime && (
            <span class="italic">
              Updated: <FormattedDate date={modDatetime} />
            </span>
          )}
          <span class="italic">&bull; {readingTime}</span>
        </div>
        {tags.length > 0 && (
          <div class="mt-4 flex flex-wrap gap-2">
            {tags.map((tag) => <Tag tag={tag} />)}
          </div>
        )}
      </header>

      {heroImage && (
        <img
          src={heroImage}
          alt={title}
          class="mb-8 w-full rounded-lg border-2 border-border transition-shadow duration-300 hover:shadow-lg"
        />
      )}

      <div class="prose prose-lg max-w-none">
        <Content />
      </div>
    </article>

    <Hr />

    <div class="flex flex-wrap items-center justify-between gap-4 py-4">
      <ShareLinks title={title} url={Astro.url.href} />
      <EditPost filePath={post.id} />
    </div>
  </main>
  <Footer />
</Layout>
