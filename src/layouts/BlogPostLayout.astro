---
import Layout from "./Layout.astro";
import Header from "@/components/Header.astro";
import Footer from "@/components/Footer.astro";
import Hr from "@/components/Hr.astro";
import FormattedDate from "@/components/FormattedDate.astro";
import Tag from "@/components/Tag.astro";
import ShareLinks from "@/components/ShareLinks.astro";
import EditPost from "@/components/EditPost.astro";
import { getReadingTime } from "@/utils/readingTime";
import { render, type CollectionEntry } from "astro:content";

interface Props {
  post: CollectionEntry<"blog">;
}

const { post } = Astro.props;
const { title, description, pubDatetime, modDatetime, tags, heroImage } = post.data;
const { Content } = await render(post);
const readingTime = getReadingTime(post.body ?? "");
---

<Layout
  title={title}
  description={description}
  pubDatetime={pubDatetime}
  modDatetime={modDatetime}
  scrollSmooth
>
  <Header />
  <main id="main-content" class="mx-auto w-full max-w-3xl flex-1 px-4 pb-12">
    <button
      onclick="history.back()"
      class="mb-6 mt-8 flex items-center gap-1 text-sm opacity-70 hover:text-accent transition-colors"
    >
      <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m15 18-6-6 6-6"/></svg>
      Go back
    </button>

    <article data-pagefind-body>
      <header class="mb-8">
        <h1 class="text-2xl font-bold leading-tight tracking-wide sm:text-3xl">{title}</h1>
        <div class="mt-3 flex flex-wrap items-center gap-3 text-sm opacity-70">
          <FormattedDate date={pubDatetime} />
          {modDatetime && (
            <span class="italic">
              Updated: <FormattedDate date={modDatetime} />
            </span>
          )}
          <span class="italic">&bull; {readingTime}</span>
        </div>
        {tags.length > 0 && (
          <div class="mt-4 flex flex-wrap gap-2">
            {tags.map((tag) => <Tag tag={tag} />)}
          </div>
        )}
      </header>

      {heroImage && (
        <img
          src={heroImage}
          alt={title}
          class="mb-8 w-full rounded-lg border-2 border-border"
        />
      )}

      <div class="prose prose-lg max-w-none">
        <Content />
      </div>
    </article>

    <Hr />

    <div class="flex flex-wrap items-center justify-between gap-4 py-4">
      <ShareLinks title={title} url={Astro.url.href} />
      <EditPost filePath={post.id} />
    </div>
  </main>
  <Footer />
</Layout>
