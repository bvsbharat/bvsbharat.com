---
import FormattedDate from "./FormattedDate.astro";
import { getReadingTime } from "@/utils/readingTime";
import type { CollectionEntry } from "astro:content";

interface Props {
  post: CollectionEntry<"blog">;
  section?: string;
}

const { post, section = "" } = Astro.props;
const { title, description, pubDatetime, modDatetime } = post.data;
const readingTime = getReadingTime(post.body ?? "");
const postUrl = `/posts/${post.id.replace(/\.(md|mdx)$/, "")}`;
const slug = post.id.replace(/\.(md|mdx)$/, "").replace(/\//g, "-");
const transitionName = section ? `${section}-${slug}` : `post-${slug}`;
---

<li class="my-6 group">
  <a
    href={postUrl}
    class="block rounded-lg p-4 -mx-4 transition-all duration-200 hover:bg-muted/40"
  >
    <h3
      class="text-lg font-medium text-accent decoration-dashed underline-offset-4 group-hover:underline transition-colors duration-200"
      style={`view-transition-name: ${transitionName}`}
    >
      {title}
    </h3>
    <div class="flex items-center gap-3 mb-2 mt-1">
      <span class="text-sm opacity-70">
        <FormattedDate date={pubDatetime} />
        {modDatetime && <span class="italic"> (updated)</span>}
      </span>
      <span class="text-sm italic opacity-80">&bull; {readingTime}</span>
    </div>
    <p class="opacity-80 transition-opacity duration-200 group-hover:opacity-100">{description}</p>
  </a>
</li>
