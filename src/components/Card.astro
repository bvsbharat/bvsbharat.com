---
import FormattedDate from "./FormattedDate.astro";
import { getReadingTime } from "@/utils/readingTime";
import type { CollectionEntry } from "astro:content";

interface Props {
  post: CollectionEntry<"blog">;
  enableTransition?: boolean;
}

const { post, enableTransition = false } = Astro.props;
const { title, description, pubDatetime, modDatetime, heroImage } = post.data;
const readingTime = getReadingTime(post.body ?? "");
const postUrl = `/posts/${post.id.replace(/\.(md|mdx)$/, "")}`;
const slug = post.id.replace(/\.(md|mdx)$/, "").replace(/\//g, "-");

---

<li class="my-6 group">
  <a
    href={postUrl}
    class="flex gap-4 items-start rounded-lg p-4 -mx-4 transition-all duration-200 hover:bg-muted/40"
  >
    <div class="flex-1 min-w-0">
      <h3
        transition:name={enableTransition ? slug : undefined}
        class="text-lg font-medium text-accent decoration-dashed underline-offset-4 group-hover:underline transition-colors duration-200"
      >
        {title}
      </h3>
      <div class="flex items-center gap-3 mb-2 mt-1">
        <span class="text-sm opacity-70">
          <FormattedDate date={pubDatetime} />
          {modDatetime && <span class="italic"> (updated)</span>}
        </span>
        <span class="text-sm italic opacity-80">&bull; {readingTime}</span>
      </div>
      <p class="opacity-80 transition-opacity duration-200 group-hover:opacity-100">{description}</p>
    </div>
    {heroImage && (
      <img
        src={heroImage}
        alt={title}
        transition:name={enableTransition ? `hero-${slug}` : undefined}
        class="hidden sm:block w-28 h-20 object-cover rounded border border-border shrink-0 transition-transform duration-200 group-hover:scale-105"
      />
    )}
  </a>
</li>
